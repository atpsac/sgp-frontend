<div class="tara-modal">
  <!-- Cerrar -->
  <button type="button" class="tara-close" (click)="close()" [disabled]="loading">
    &times;
  </button>

  <!-- HEADER -->
  <div class="tara-header">
    <h4 class="tara-title">{{ title }}</h4>
    <p class="tara-subtitle">{{ subtitle }}</p>
  </div>

  <!-- RESUMEN -->
  <div class="tara-summary">
    <div class="tara-summary__group">
      <div class="tara-summary__item">
        <div class="tara-summary__label">Totales</div>
      </div>

      <div class="tara-summary__item">
        <div class="tara-summary__label">Cantidad ítems</div>
        <div class="tara-summary__value">
          <ng-container *ngIf="!loadingTotals; else totSpin1">
            {{ resumen.cantidadItems || 0 }}
          </ng-container>
          <ng-template #totSpin1>
            <span class="spinner-border spinner-border-sm" aria-hidden="true"></span>
          </ng-template>
        </div>
      </div>

      <div class="tara-summary__item">
        <div class="tara-summary__label">Cantidad empaques</div>
        <div class="tara-summary__value">
          <ng-container *ngIf="!loadingTotals; else totSpin2">
            {{ resumen.cantidadEmpaques || 0 }}
          </ng-container>
          <ng-template #totSpin2>
            <span class="spinner-border spinner-border-sm" aria-hidden="true"></span>
          </ng-template>
        </div>
      </div>

      <div class="tara-summary__item">
        <div class="tara-summary__label">Tara (kg)</div>
        <div class="tara-summary__value">
          <ng-container *ngIf="!loadingTotals; else totSpin3">
            {{ (resumen.taraTotalKg || 0) | number : '1.2-2' }}
          </ng-container>
          <ng-template #totSpin3>
            <span class="spinner-border spinner-border-sm" aria-hidden="true"></span>
          </ng-template>
        </div>
      </div>
    </div>

    <div class="tara-summary__actions">
      <button
        type="button"
        class="tara-add-btn"
        (click)="onClickAgregarTara()"
        [disabled]="loading"
      >
        <span class="material-symbols-rounded">add</span>
        <span>Agregar tara</span>
      </button>
    </div>
  </div>

  <!-- TABLA -->
  <div class="tara-table-wrapper">
    <div class="tara-loading" *ngIf="loading">
      <span class="spinner-border spinner-border-sm me-2" aria-hidden="true"></span>
      Cargando…
    </div>

    <table class="tara-table table table-hover m-0">
      <thead>
        <tr>
          <th class="tara-col-idx">Item</th>
          <th>Empaque</th>
          <th>Código</th>
          <th>Descripción</th>
          <th class="text-end">Tara x empaque (kg)</th>
          <th class="text-end">Cantidad</th>
          <th class="text-end">Tara (kg)</th>
          <th class="tara-col-actions text-center">Acciones</th>
        </tr>
      </thead>

      <tbody *ngIf="taras.length > 0; else taraEmpty">
        <tr *ngFor="let row of taras; let i = index">
          <td class="tara-col-idx" [attr.data-label]="'Item'">
            {{ (currentPage - 1) * pageSize + i + 1 | number : '2.0-0' }}
          </td>

          <td [attr.data-label]="'Empaque'">
            {{ row.empaque }}
          </td>

          <td [attr.data-label]="'Código'">
            {{ row.codigo }}
          </td>

          <td [attr.data-label]="'Descripción'">
            {{ row.descripcion }}
          </td>

          <td class="text-end" [attr.data-label]="'Tara x empaque (kg)'">
            {{ row.taraPorEmpaqueKg | number : '1.2-2' }}
          </td>

          <td class="text-end" [attr.data-label]="'Cantidad'">
            {{ row.cantidad }}
          </td>

          <td class="text-end" [attr.data-label]="'Tara (kg)'">
            {{ row.taraKg | number : '1.2-2' }}
          </td>

          <td class="tara-col-actions text-center" [attr.data-label]="'Acciones'">
            <!-- <button
              type="button"
              class="tara-icon-btn me-1"
              title="Editar tara"
              (click)="onEditTara(row)"
              [disabled]="loading"
            >
              <span class="material-symbols-rounded">more_horiz</span>
            </button> -->

            <button
              type="button"
              class="tara-icon-btn"
              title="Eliminar tara"
              (click)="onDeleteTara(row)"
              [disabled]="loading"
            >
              <span class="material-symbols-rounded">delete</span>
            </button>
          </td>
        </tr>
      </tbody>
    </table>

    <!-- Sin registros -->
    <ng-template #taraEmpty>
      <tbody>
        <tr>
          <td colspan="8" class="text-center py-3">
            No se han registrado taras para esta pesada.
          </td>
        </tr>
      </tbody>
    </ng-template>
  </div>

  <!-- FOOTER: paginación + info -->
  <div class="tara-footer">
    <div class="tara-footer__info">
      <span class="tara-foot-text">
        {{ startRecord }} - {{ endRecord }} de {{ totalRecords }} registros.
      </span>

      <div class="tara-page-size">
        <select [(ngModel)]="pageSize" (change)="changePageSize(pageSize)" [disabled]="loading">
          <option *ngFor="let size of pageSizes" [value]="size">
            {{ size }}
          </option>
        </select>
        <span class="tara-page-size__icon material-symbols-rounded" aria-hidden="true">
          expand_more
        </span>
      </div>

      <span class="tara-foot-text">
        Orden
      </span>

      <!-- ORDEN -->
      <div class="tara-summary__item tara-sort">
        <select
          class="tara-sort__select"
          [(ngModel)]="sortDirection"
          (change)="onChangeSortDirection(sortDirection)"
          [disabled]="loading"
        >
          <option value="desc">Más recientes</option>
          <option value="asc">Más antiguos</option>
        </select>
      </div>
    </div>

    <nav aria-label="Paginación" class="tara-pagination">
      <ul class="pagination mb-0">
        <li class="page-item" [class.disabled]="currentPage === 1">
          <button type="button" class="page-link" (click)="changePage(currentPage - 1)" [disabled]="loading">
            Anterior
          </button>
        </li>

        <li class="page-item" *ngFor="let p of pages" [class.active]="currentPage === p">
          <button type="button" class="page-link" (click)="changePage(p)" [disabled]="loading">
            {{ p }}
          </button>
        </li>

        <li class="page-item" [class.disabled]="currentPage === totalPages">
          <button type="button" class="page-link" (click)="changePage(currentPage + 1)" [disabled]="loading">
            Siguiente
          </button>
        </li>
      </ul>
    </nav>
  </div>
</div>
