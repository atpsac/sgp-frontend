<div class="ux-scope">
  <div class="card ux-card p-3">
    <!-- Filtros -->
    <div class="row align-items-center g-3">
      <div class="col-md-2 col-12 mb-3">
        <h5 class="ux-title mb-0">Usuarios</h5>
      </div>

      <div class="col-md-3 col-12 mb-3">
        <input
          type="text"
          class="form-control ux-input"
          placeholder="Buscar por correo, nombre o documento"
          [(ngModel)]="filters.search"
          (keydown.enter)="applyFilters()" />
      </div>

      <!-- Filtro por Rol -->
      <div class="col-md-2 col-12 mb-3">
        <div class="ux-select">
          <select class="form-select ux-input" [(ngModel)]="filters.RolId">
            <option [ngValue]="null" selected>Todos los roles</option>
            <option *ngFor="let r of roleOptions" [ngValue]="r.RolId">
              {{ r.Nombre }}
            </option>
          </select>
          <span class="ux-select__icon material-symbols-rounded" aria-hidden="true">expand_more</span>
        </div>
      </div>

      <div class="col-md-1 col-6 mb-3">
        <button class="ux-btn ux-btn--primary w-100" (click)="applyFilters()" [disabled]="isLoading">
          <span class="material-symbols-rounded" aria-hidden="true">search</span>
        </button>
      </div>

      <div class="col-md-2 col-6 mb-3">
        <button class="ux-btn ux-btn--blue w-100" (click)="openCreate()">
          <span class="material-symbols-rounded" aria-hidden="true">add</span>
          <span>Crear</span>
        </button>
      </div>

      <div class="col-md-2 col-12 mb-3">
        <button class="ux-btn ux-btn--green w-100"
                (click)="exportarExcel()"
                [disabled]="downloading || isLoading">
          <ng-container *ngIf="!downloading">
            <span class="material-symbols-rounded" aria-hidden="true">download</span>
            <span>Exportar</span>
          </ng-container>
          <ng-container *ngIf="downloading">
            <span class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span>
            <span>Exportando…</span>
          </ng-container>
        </button>
      </div>
    </div>

    <!-- Tabla -->
    <div class="table-responsive pt-2">
      <table class="table table-hover ux-table m-0">
        <thead class="ux-table__head">
          <tr>
            <th class="ux-col-idx">#</th>
            
            <th>NroDocumento</th>
            <th>Nombres</th>
            <th>Apellidos</th>
            <!-- <th>Sexo</th> -->
            <th>Edad</th>
            <th>Rol</th>
            <th>Correo</th>
            <th>Telfono</th>
            <th class="ux-col-state">Estado</th>
            <th class="ux-col-actions">Acciones</th>
          </tr>
        </thead>

        <!-- Data -->
        <tbody *ngIf="!isLoading">
          <tr class="ux-row" *ngFor="let row of data; let i = index">
            <td class="ux-col-idx" [attr.data-label]="'#'">{{ (currentPage - 1) * pageSize + i + 1 }}</td>

            <!-- Rol: nombre simple o lista agregada -->
           
            <td [attr.data-label]="'Nro Documento'">{{ row.NumeroDocumento || '-' }}</td>
            <td [attr.data-label]="'Nombres'">{{ row.Nombres }}</td>
            <td [attr.data-label]="'Apellidos'">{{ row.Apellidos }}</td>
            <!-- <td [attr.data-label]="'Sexo'">{{ row['Sexo'] || '-' }}</td> -->

            <!-- Edad sin '??' -->
            <td [attr.data-label]="'Edad'">
              {{ row['Edad'] != null ? row['Edad'] : '-' }}
            </td>

             <td [attr.data-label]="'Rol'">
              {{ row.RolNombre  }}
            </td>

            <td [attr.data-label]="'Correo'">{{ row.Correo }}</td>
            <td [attr.data-label]="'Telfono'">{{ row.Telefono || '-' }}</td>
            
            <td [attr.data-label]="'Estado'">
              <span class="ux-badge"
                    [class.ux-badge--ok]="row.FlagActivo==1"
                    [class.ux-badge--bad]="row.FlagActivo==0"
                    (click)="openStatus(row)"
                    title="Cambiar estado">
                {{ row.FlagActivo==1 ? 'Activo' : 'Inactivo' }}
              </span>
            </td>

            <td class="ux-col-actions" [attr.data-label]="'Acciones'">
              <button class="ux-icon-btn ux-icon-btn--sm ux-icon-btn--medium" (click)="openEdit(row)" title="Editar">
                <img src="assets/icons/edit.png" width="15" height="15" />
              </button>
              <button class="ux-icon-btn ux-icon-btn--sm ux-icon-btn--medium" (click)="openDelete(row)" title="Eliminar">
                <img src="assets/icons/delete.png" width="15" height="15" />
              </button>
            </td>
          </tr>
          <tr *ngIf="data.length===0">
            <td colspan="9" class="text-center">No se encontraron resultados</td>
          </tr>
        </tbody>

        <!-- Skeleton -->
        <tbody *ngIf="isLoading">
          <tr class="ux-skel-row" *ngFor="let i of [1,2,3,4,5,6,7,8]">
            <td><div class="ux-skel ux-skel--icon"></div></td>
            <td><div class="ux-skel"></div></td>
            <td><div class="ux-skel"></div></td>
            <td><div class="ux-skel"></div></td>
            <td><div class="ux-skel"></div></td>
            <td><div class="ux-skel"></div></td>
            <td><div class="ux-skel"></div></td>
            <td><div class="ux-skel ux-skel--badge"></div></td>
            <td><div class="ux-skel ux-skel--actions"></div></td>
          </tr>
        </tbody>
      </table>

      <!-- Footer -->
      <div class="ux-table__footer d-flex justify-content-between align-items-center w-100 flex-wrap">
        <div class="d-flex align-items-center gap-2">
          <span class="ux-foot-info">{{ startRecord }} - {{ endRecord }} de {{ totalRecords }} registros.</span>
          <div class="ux-select ux-select--compact">
            <select class="form-select ux-input"
                    [(ngModel)]="pageSize"
                    (change)="changePageSize(pageSize)">
              <option *ngFor="let size of pageSizes" [value]="size">{{ size }}</option>
            </select>
            <span class="ux-select__icon material-symbols-rounded">expand_more</span>
          </div>
        </div>

        <nav class="ux-pagination">
          <ul class="pagination mb-0">
            <li class="page-item" [class.disabled]="currentPage===1">
              <button class="page-link" (click)="changePage(currentPage-1)">Anterior</button>
            </li>
            <li class="page-item" *ngFor="let page of getPageRange()" [class.active]="page===currentPage">
              <button *ngIf="page>0" class="page-link" (click)="changePage(page)">{{ page }}</button>
              <span *ngIf="page===-1 || page===-2" class="page-link">…</span>
            </li>
            <li class="page-item" [class.disabled]="currentPage===totalPages">
              <button class="page-link" (click)="changePage(currentPage+1)">Siguiente</button>
            </li>
          </ul>
        </nav>
      </div>
    </div>
  </div>
</div>
